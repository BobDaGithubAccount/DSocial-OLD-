
    struct DirectMessageUser {
        uint256 groupChatCount;
    }
    
    mapping(address => DirectMessageUser) GlobalDirectMessageUsers;
    
    struct DirectMessage {
        string message;
        address sender;
        address target;
        uint256 id;
    }
    
    struct DirectMessages {
        mapping(uint256 => DirectMessage[]) UsersMessages;
    }
    
    struct DirectMessageGroupData {
        address[] GroupMembers;
    }
    
    struct DirectMessageData {
        DirectMessageGroupData gm;
        uint256 messageCount;
    }
    
    mapping(address => DirectMessages) GlobalDirectMessages;
    mapping(address => DirectMessageData) GlobalDirectMessageData;
    
    function sendDirectMessage(address creator, address target, uint256 id, string memory text) public returns(bool) {
        if(isMemberOfDM(creator, msg.sender, id)) {
            uint256 a = GlobalDirectMessageData[creator].messageCount;
            GlobalDirectMessageData[creator].messageCount = a + 1;
            GlobalDirectMessages[creator].UsersMessages[id].push(DirectMessage(text, msg.sender, target, a));
            return true;
        }
        else {
            return false;
        }
    }
    
    function isMemberOfDM(address creator, address target, uint256 id) public view returns(bool) {
        address[] memory members = GlobalDirectMessageData[creator].gm.GroupMembers;
        if(members[0] == target) {
            return true;
        }
        else if(members[1] == target) {
            return true;
        }
        else {
            return false;
        }
    }
    
    function getDirectMessages(address creator, uint256 id) public view returns(DirectMessage[] memory) {
        if(isMemberOfDM(creator, msg.sender, id)) {
            return GlobalDirectMessages[creator].UsersMessages[id];
        }
        else {
            DirectMessage[] memory dm;
            return dm;
        }
    }
    
    function createDirectMessageChannel(address target) public {
        uint256 a = GlobalDirectMessageUsers[msg.sender].groupChatCount;
        GlobalDirectMessageUsers[msg.sender].groupChatCount = a + 1;
        
        address[] memory members;
        members[0] = msg.sender;
        members[1] = target;
        DirectMessageGroupData memory dmgd = DirectMessageGroupData(members);
        DirectMessageData memory directmessagedata = DirectMessageData(dmgd, 0);
        GlobalDirectMessageData[msg.sender] = directmessagedata;
        
        DirectMessage[] memory dms;
        GlobalDirectMessages[msg.sender].UsersMessages[a] = dms;
    }
